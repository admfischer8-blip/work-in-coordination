<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work in Coordination - ระบบประสานงาน</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-form {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 400px;
        }

        .login-form h2 {
            margin-bottom: 30px;
            color: #495057;
            font-size: 2em;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #6c757d;
            font-size: 1.1em;
        }

        .controls {
            padding: 30px;
            background: white;
            border-bottom: 2px solid #e9ecef;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }

        input, select, textarea {
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background: white;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-upload-label {
            display: block;
            padding: 12px 15px;
            border: 2px dashed #e9ecef;
            border-radius: 10px;
            text-align: center;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .file-upload-label:hover {
            border-color: #4facfe;
            color: #4facfe;
        }

        .file-list {
            margin-top: 10px;
        }

        .file-item {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 172, 254, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 15px 15px 0 0;
            margin: 0 30px;
            margin-top: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #4facfe;
            border-radius: 15px 15px 0 0;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .task-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: left;
            font-weight: 600;
        }

        .task-table td {
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: top;
        }

        .task-table tr:hover {
            background: #f8f9fa;
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-todo { background: #ffc107; color: #856404; }
        .status-inprogress { background: #17a2b8; color: white; }
        .status-review { background: #fd7e14; color: white; }
        .status-done { background: #28a745; color: white; }

        .priority {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }

        .priority-urgent { background: #dc3545; color: white; }
        .priority-normal { background: #28a745; color: white; }

        .urgency {
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }

        .urgency-urgent { background: #dc3545; color: white; }
        .urgency-normal { background: #28a745; color: white; }

        .assignee {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .folders-section {
            background: white;
            margin: 20px 30px;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .folder-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .folder-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .folder-card:hover {
            background: #e9ecef;
            border-color: #4facfe;
        }

        .folder-icon {
            font-size: 48px;
            margin-bottom: 10px;
            color: #4facfe;
        }

        .notification-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .notification-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ddd;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .toggle.active {
            background: #4facfe;
        }

        .toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle.active::after {
            transform: translateX(25px);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 80%;
            overflow-y: auto;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
        }

        .recurring-badge {
            background: #17a2b8;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        .attachment-icon {
            color: #4facfe;
            font-size: 16px;
            margin-right: 5px;
        }

        .link-item {
            background: #e7f3ff;
            padding: 8px 12px;
            border-radius: 8px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .task-table { font-size: 14px; }
            .task-table th, .task-table td { padding: 10px 8px; }
            .header { flex-direction: column; gap: 15px; }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-form">
            <h2>🔐 เข้าสู่ระบบ</h2>
            <div class="form-group" style="margin-bottom: 20px;">
                <label>ชื่อผู้ใช้</label>
                <input type="text" id="loginUsername" placeholder="กรอกชื่อผู้ใช้" required>
            </div>
            <div class="form-group" style="margin-bottom: 30px;">
                <label>รหัสผ่าน</label>
                <input type="password" id="loginPassword" placeholder="กรอกรหัสผ่าน" required>
            </div>
            <button onclick="login()" class="btn btn-primary" style="width: 100%;">เข้าสู่ระบบ</button>
            <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">
                Demo: Farida/1232, lyn/2207, Admin/admin123
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <div class="header-left">
                <h1>🤝 Work in Coordination</h1>
                <p>ระบบจัดการการทำงานร่วมกัน</p>
            </div>
            <div class="header-right">
                <div class="user-info" id="userInfo">👤 ผู้ใช้</div>
                <button onclick="generateReport()" class="btn btn-success">📄 สร้างรายงาน PDF</button>
                <button onclick="logout()" class="btn btn-secondary">ออกจากระบบ</button>
            </div>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalTasks">0</div>
                <div class="stat-label">งานทั้งหมด</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedTasks">0</div>
                <div class="stat-label">งานเสร็จแล้ว</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="urgentTasks">0</div>
                <div class="stat-label">งานด่วน</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="recurringTasks">0</div>
                <div class="stat-label">งานประจำ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="overdueTasks">0</div>
                <div class="stat-label">งานเกินกำหนด</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('tasks')">📋 งาน</button>
            <button class="tab" onclick="showTab('folders')">📁 โฟล์เดอร์</button>
            <button class="tab" onclick="showTab('notifications')">🔔 การแจ้งเตือน</button>
            <button class="tab" onclick="showTab('collaborate')">👥 ทำงานร่วมกัน</button>
        </div>

        <!-- Tasks Tab -->
        <div class="tab-content active" id="tasks">
            <div class="controls">
                <h2 style="margin-bottom: 20px; color: #495057;">➕ เพิ่มงานใหม่</h2>
                <div id="taskForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskTitle">ชื่องาน *</label>
                            <input type="text" id="taskTitle" placeholder="กรอกชื่องาน..." required>
                        </div>
                        <div class="form-group">
                            <label for="taskAssigner">ผู้มอบหมาย</label>
                            <select id="taskAssigner" required>
                                <option value="">เลือกผู้มอบหมาย...</option>
                                <option value="DOKKUN">DOKKUN</option>
                                <option value="KITTISAK">KITTISAK</option>
                                <option value="SURACHART">SURACHART</option>
                                <option value="SOMYOS">SOMYOS</option>
                                <option value="ULIS">ULIS</option>
                                <option value="WICHAI">WICHAI</option>
                                <option value="WATCHARA">WATCHARA</option>
                                <option value="ANIRUTTNIPON">ANIRUTTNIPON</option>
                                <option value="NIPON">NIPON</option>
                                <option value="THUSSAPORNNUTPUDIS">THUSSAPORNNUTPUDIS</option>
                                <option value="NUTPUDIS">NUTPUDIS</option>
                                <option value="KANOKWAN">KANOKWAN</option>
                                <option value="WANNAPA">WANNAPA</option>
                                <option value="ARTHITAYA">ARTHITAYA</option>
                                <option value="UNCHITA">UNCHITA</option>
                                <option value="KANITIN">KANITIN</option>
                                <option value="FARIDA">FARIDA</option>
                                <option value="WARISA">WARISA</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskAssignee">ผู้รับผิดชอบ *</label>
                            <select id="taskAssignee" required>
                                <option value="">เลือกผู้รับผิดชอบ...</option>
                                <option value="FARIDA">FARIDA</option>
                                <option value="WARISA">WARISA</option>
                                <option value="Both">ทั้งคู่</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskUrgency">ความเร่งด่วน</label>
                            <select id="taskUrgency" required>
                                <option value="Normal">ปกติ</option>
                                <option value="Urgent">ด่วน</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskStartDate">วันเริ่มงาน</label>
                            <input type="date" id="taskStartDate">
                        </div>
                        <div class="form-group">
                            <label for="taskDueDate">กำหนดส่ง *</label>
                            <input type="date" id="taskDueDate" required>
                        </div>
                        <div class="form-group">
                            <label for="taskRecurring">งานประจำ</label>
                            <select id="taskRecurring">
                                <option value="">ไม่ซ้ำ</option>
                                <option value="monthly">ทุกเดือน</option>
                                <option value="weekly">ทุกสัปดาห์</option>
                                <option value="daily">ทุกวัน</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="taskDescription">รายละเอียด/วัตถุประสงค์</label>
                            <textarea id="taskDescription" placeholder="อธิบายรายละเอียดและวัตถุประสงค์ของงาน..."></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>แนบไฟล์</label>
                            <div class="file-upload">
                                <input type="file" id="taskFiles" multiple>
                                <label for="taskFiles" class="file-upload-label">
                                    📎 คลิกเพื่อแนบไฟล์ หรือลากไฟล์มาวาง
                                </label>
                            </div>
                            <div class="file-list" id="fileList"></div>
                        </div>
                        <div class="form-group">
                            <label for="taskLinks">ลิงก์ที่เกี่ยวข้อง</label>
                            <input type="url" id="taskLinks" placeholder="https://example.com">
                            <button type="button" onclick="addLink()" class="btn btn-secondary" style="margin-top: 10px; padding: 8px 15px;">เพิ่มลิงก์</button>
                            <div class="file-list" id="linksList"></div>
                        </div>
                    </div>
                    <button onclick="addTask()" class="btn btn-primary">เพิ่มงาน</button>
                </div>
            </div>

            <div class="task-list" style="padding: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #495057;">📋 รายการงาน</h2>
                    <button onclick="autoBalance()" class="btn btn-secondary">⚖️ จัดสมดุลงาน</button>
                </div>
                
                <div class="filters">
                    <select id="filterStatus" onchange="filterTasks()">
                        <option value="">ทุกสถานะ</option>
                        <option value="To Do">รอดำเนินการ</option>
                        <option value="In Progress">กำลังทำ</option>
                        <option value="Review">ตรวจสอบ</option>
                        <option value="Done">เสร็จ</option>
                    </select>
                    <select id="filterAssignee" onchange="filterTasks()">
                        <option value="">ทุกคน</option>
                        <option value="FARIDA">FARIDA</option>
                        <option value="WARISA">WARISA</option>
                        <option value="Both">ทั้งคู่</option>
                    </select>
                    <select id="filterUrgency" onchange="filterTasks()">
                        <option value="">ทุกระดับ</option>
                        <option value="Urgent">ด่วน</option>
                        <option value="Normal">ปกติ</option>
                    </select>
                    <input type="text" id="searchTasks" placeholder="ค้นหางาน..." onkeyup="filterTasks()">
                </div>

                <div style="overflow-x: auto;">
                    <table class="task-table">
                        <thead>
                            <tr>
                                <th>งาน</th>
                                <th>ผู้มอบหมาย</th>
                                <th>ผู้รับผิดชอบ</th>
                                <th>ความเร่งด่วน</th>
                                <th>สถานะ</th>
                                <th>วันที่</th>
                                <th>การดำเนินการ</th>
                            </tr>
                        </thead>
                        <tbody id="taskTableBody">
                            <tr>
                                <td colspan="7" class="empty-state">
                                    <div>📝 ยังไม่มีงาน เพิ่มงานแรกได้เลย!</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Folders Tab -->
        <div class="tab-content" id="folders">
            <div class="folders-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #495057;">📁 โฟล์เดอร์เอกสาร</h2>
                    <button onclick="createFolder()" class="btn btn-primary">+ สร้างโฟล์เดอร์</button>
                </div>
                <div class="folder-grid" id="folderGrid">
                    <div class="folder-card" onclick="openFolder('documents')">
                        <div class="folder-icon">📄</div>
                        <div>เอกสาร</div>
                        <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">0 ไฟล์</div>
                    </div>
                    <div class="folder-card" onclick="openFolder('images')">
                        <div class="folder-icon">🖼️</div>
                        <div>รูปภาพ</div>
                        <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">0 ไฟล์</div>
                    </div>
                    <div class="folder-card" onclick="openFolder('shared')">
                        <div class="folder-icon">👥</div>
                        <div>แชร์ร่วมกัน</div>
                        <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">0 ไฟล์</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div class="tab-content" id="notifications">
            <div style="padding: 30px;">
                <h2 style="color: #495057; margin-bottom: 20px;">🔔 ตั้งค่าการแจ้งเตือน</h2>
                
                <div class="notification-settings">
                    <h3 style="margin-bottom: 15px;">การแจ้งเตือนทั่วไป</h3>
                    <div class="notification-row">
                        <span>แจ้งเตือนงานใหม่</span>
                        <div class="toggle active" onclick="toggleNotification(this)"></div>
                    </div>
                    <div class="notification-row">
                        <span>แจ้งเตือนก่อนครบกำหนด 1 วัน</span>
                        <div class="toggle active" onclick="toggleNotification(this)"></div>
                    </div>
                    <div class="notification-row">
                        <span>แจ้งเตือนงานเกินกำหนด</span>
                        <div class="toggle active" onclick="toggleNotification(this)"></div>
                    </div>
                </div>

                <div class="notification-settings" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">ช่องทางการแจ้งเตือน</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lineToken">LINE Notify Token</label>
                            <input type="text" id="lineToken" placeholder="กรอก LINE Token..." onchange="saveUserSettings()">
                            <button onclick="testLineNotification()" class="btn btn-secondary" style="margin-top: 10px; padding: 8px 15px;">ทดสอบ LINE</button>
                        </div>
                        <div class="form-group">
                            <label for="emailSettings">อีเมลสำหรับแจ้งเตือน</label>
                            <input type="email" id="emailSettings" placeholder="example@email.com" onchange="saveUserSettings()">
                            <button onclick="testEmailNotification()" class="btn btn-secondary" style="margin-top: 10px; padding: 8px 15px;">ทดสอบอีเมล</button>
                        </div>
                    </div>
                </div>

                <div class="notification-settings" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">💾 จัดการข้อมูล</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <button onclick="exportData()" class="btn btn-primary">📤 ส่งออกข้อมูล</button>
                        <button onclick="importData()" class="btn btn-secondary">📥 นำเข้าข้อมูล</button>
                        <button onclick="showStorageInfo()" class="btn btn-success">💾 ข้อมูลการใช้งาน</button>
                        <button onclick="clearAllData()" class="btn btn-danger">🗑️ ลบข้อมูลทั้งหมด</button>
                    </div>
                    <div id="storageInfo" style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 10px; display: none;">
                        <h4>📊 สถิติการใช้พื้นที่เก็บข้อมูล</h4>
                        <div id="storageDetails"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Collaborate Tab -->
        <div class="tab-content" id="collaborate">
            <div style="padding: 30px;">
                <h2 style="color: #495057; margin-bottom: 20px;">👥 ทำงานร่วมกัน</h2>
                
                <div class="notification-settings">
                    <h3 style="margin-bottom: 15px;">สมาชิกในทีม</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div class="stat-card">
                            <div style="font-size: 48px; margin-bottom: 10px;">👤</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">FARIDA</div>
                            <div style="font-size: 12px; color: #28a745;">🟢 ออนไลน์</div>
                            <div style="font-size: 14px; color: #6c757d; margin-top: 10px;" id="FARIDA-workload">0 งานที่ได้รับมอบหมาย</div>
                        </div>
                        <div class="stat-card">
                            <div style="font-size: 48px; margin-bottom: 10px;">👤</div>
                            <div style="font-weight: 600; margin-bottom: 5px;">WARISA</div>
                            <div style="font-size: 12px; color: #28a745;">🟢 ออนไลน์</div>
                            <div style="font-size: 14px; color: #6c757d; margin-top: 10px;" id="WARISA-workload">0 งานที่ได้รับมอบหมาย</div>
                        </div>
                    </div>
                </div>

                <div class="notification-settings" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">แชร์ลิงก์ทำงาน</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ลิงก์สำหรับแชร์</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="shareLink" value="https://task-manager.app/team/abc123" readonly>
                                <button onclick="copyShareLink()" class="btn btn-secondary">คัดลอก</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>QR Code สำหรับแชร์</label>
                            <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                                <div style="font-size: 80px;">📱</div>
                                <div style="font-size: 12px; color: #6c757d;">QR Code สำหรับแชร์</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="notification-settings" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">กิจกรรมล่าสุด</h3>
                    <div id="activityFeed" style="max-height: 300px; overflow-y: auto;">
                        <div style="padding: 10px; border-left: 3px solid #4facfe; margin-bottom: 10px; background: #f8f9fa;">
                            <div style="font-weight: 600;">ระบบเริ่มทำงาน</div>
                            <div style="font-size: 12px; color: #6c757d;">เมื่อสักครู่</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">รายละเอียดงาน</h3>
            <div id="taskModalContent"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeModal()" class="btn btn-secondary">ปิด</button>
            </div>
        </div>
    </div>

    <div class="modal" id="folderModal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">โฟล์เดอร์: <span id="currentFolderName"></span></h3>
            <div style="margin-bottom: 20px;">
                <input type="file" id="folderUpload" multiple style="display: none;">
                <button onclick="document.getElementById('folderUpload').click()" class="btn btn-primary">📤 อัปโหลดไฟล์</button>
            </div>
            <div id="folderContent" style="max-height: 400px; overflow-y: auto;"></div>
            <div style="text-align: right; margin-top: 20px;">
                <button onclick="closeModal()" class="btn btn-secondary">ปิด</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let tasks = [];
        let folders = {
            'documents': [],
            'images': [],
            'shared': []
        };
        let taskIdCounter = 1;
        let currentUser = '';
        let taskFiles = [];
        let taskLinks = [];
        let userSettings = {};

        // Storage Keys
        const STORAGE_KEYS = {
            TASKS: 'workCoord_tasks',
            FOLDERS: 'workCoord_folders',
            TASK_COUNTER: 'workCoord_taskCounter',
            USER_SETTINGS: 'workCoord_userSettings'
        };

        // Authentication
        const users = {
            'Farida': '1232',
            'lyn': '2207',
            'Admin': 'admin123'
        };

        function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (users[username] && users[username] === password) {
                currentUser = username;
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('userInfo').textContent = `👤 ${username}`;
                loadUserData();
                enableAutoSave();
            } else {
                alert('ชื่อผู้ใช้หรือรหัสผ่านไม่ถูกต้อง');
            }
        }

        function logout() {
            if (confirm('ต้องการออกจากระบบหรือไม่?')) {
                currentUser = '';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'none';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
            }
        }

        // Data Management
        function saveData() {
            try {
                localStorage.setItem(STORAGE_KEYS.TASKS, JSON.stringify(tasks));
                localStorage.setItem(STORAGE_KEYS.FOLDERS, JSON.stringify(folders));
                localStorage.setItem(STORAGE_KEYS.TASK_COUNTER, JSON.stringify(taskIdCounter));
                localStorage.setItem(STORAGE_KEYS.USER_SETTINGS, JSON.stringify(userSettings));
                showSaveIndicator();
            } catch (error) {
                console.error('Error saving data:', error);
                alert('เกิดข้อผิดพลาดในการบันทึกข้อมูล');
            }
        }

        function loadData() {
            try {
                const savedTasks = localStorage.getItem(STORAGE_KEYS.TASKS);
                if (savedTasks) tasks = JSON.parse(savedTasks);

                const savedFolders = localStorage.getItem(STORAGE_KEYS.FOLDERS);
                if (savedFolders) folders = JSON.parse(savedFolders);

                const savedCounter = localStorage.getItem(STORAGE_KEYS.TASK_COUNTER);
                if (savedCounter) taskIdCounter = JSON.parse(savedCounter);

                const savedSettings = localStorage.getItem(STORAGE_KEYS.USER_SETTINGS);
                if (savedSettings) {
                    userSettings = JSON.parse(savedSettings);
                    restoreUserSettings();
                }
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function showSaveIndicator() {
            let indicator = document.getElementById('saveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'saveIndicator';
                indicator.className = 'save-indicator';
                indicator.innerHTML = '💾 บันทึกแล้ว';
                document.body.appendChild(indicator);
            }
            
            indicator.style.opacity = '1';
            setTimeout(() => {
                indicator.style.opacity = '0';
            }, 2000);
        }

        function enableAutoSave() {
            setInterval(saveData, 30000);
            window.addEventListener('beforeunload', saveData);
        }

        function loadUserData() {
            loadData();
            renderTasks();
            updateStats();
            updateCollaborationStats();
            renderFolders();
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Task Management
        function addTask() {
            const title = document.getElementById('taskTitle').value.trim();
            const assigner = document.getElementById('taskAssigner').value;
            const assignee = document.getElementById('taskAssignee').value;
            const urgency = document.getElementById('taskUrgency').value;
            const startDate = document.getElementById('taskStartDate').value;
            const dueDate = document.getElementById('taskDueDate').value;
            const recurring = document.getElementById('taskRecurring').value;
            const description = document.getElementById('taskDescription').value.trim();

            if (!title || !assignee || !dueDate) {
                alert('กรุณากรอกข้อมูลที่จำเป็น (ชื่องาน, ผู้รับผิดชอบ, กำหนดส่ง)');
                return;
            }

            const task = {
                id: taskIdCounter++,
                title: title,
                assigner: assigner,
                assignee: assignee,
                urgency: urgency,
                startDate: startDate,
                dueDate: dueDate,
                recurring: recurring,
                description: description,
                status: 'To Do',
                createdDate: new Date().toLocaleDateString('th-TH'),
                createdTime: new Date().toLocaleString('th-TH'),
                files: [...taskFiles],
                links: [...taskLinks],
                completedDate: null,
                creator: currentUser
            };
            
            tasks.push(task);
            
            if (task.recurring) {
                createRecurringTasks(task);
            }
            
            saveData();
            clearTaskForm();
            renderTasks();
            updateStats();
            updateCollaborationStats();
            
            sendNotification(`งานใหม่: ${task.title}`, `${task.assigner} มอบหมายงานให้ ${task.assignee}`);
        }

        function clearTaskForm() {
            document.getElementById('taskTitle').value = '';
            document.getElementById('taskAssigner').value = '';
            document.getElementById('taskAssignee').value = '';
            document.getElementById('taskUrgency').value = 'Normal';
            document.getElementById('taskStartDate').value = '';
            document.getElementById('taskDueDate').value = '';
            document.getElementById('taskRecurring').value = '';
            document.getElementById('taskDescription').value = '';
            
            taskFiles = [];
            taskLinks = [];
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('linksList').innerHTML = '';
        }

        function createRecurringTasks(originalTask) {
            const recurringCount = 12;
            for (let i = 1; i <= recurringCount; i++) {
                const nextDate = new Date(originalTask.dueDate);
                
                if (originalTask.recurring === 'monthly') {
                    nextDate.setMonth(nextDate.getMonth() + i);
                } else if (originalTask.recurring === 'weekly') {
                    nextDate.setDate(nextDate.getDate() + (i * 7));
                } else if (originalTask.recurring === 'daily') {
                    nextDate.setDate(nextDate.getDate() + i);
                }
                
                const recurringTask = {
                    ...originalTask,
                    id: taskIdCounter++,
                    dueDate: nextDate.toISOString().split('T')[0],
                    startDate: new Date(nextDate.getTime() - 24*60*60*1000).toISOString().split('T')[0],
                    createdDate: new Date().toLocaleDateString('th-TH'),
                    createdTime: new Date().toLocaleString('th-TH')
                };
                
                tasks.push(recurringTask);
            }
        }

        function renderTasks() {
            const tbody = document.getElementById('taskTableBody');
            
            if (tasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div>📝 ยังไม่มีงาน เพิ่มงานแรกได้เลย!</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            const filteredTasks = getFilteredTasks();
            
            if (filteredTasks.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="empty-state">
                            <div>🔍 ไม่พบงานที่ตรงกับเงื่อนไขการค้นหา</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredTasks.map(task => `
                <tr onclick="viewTaskDetails(${task.id})" style="cursor: pointer;">
                    <td>
                        <div style="font-weight: 600; margin-bottom: 5px;">
                            ${task.title}
                            ${task.recurring ? '<span class="recurring-badge">ประจำ</span>' : ''}
                            ${task.files.length > 0 ? '<span class="attachment-icon">📎</span>' : ''}
                            ${task.links.length > 0 ? '<span class="attachment-icon">🔗</span>' : ''}
                        </div>
                        <div style="font-size: 12px; color: #6c757d;">${task.description || 'ไม่มีรายละเอียด'}</div>
                    </td>
                    <td><span class="assignee">${task.assigner || 'ไม่ระบุ'}</span></td>
                    <td><span class="assignee">${task.assignee}</span></td>
                    <td><span class="urgency urgency-${task.urgency.toLowerCase()}">${task.urgency === 'Urgent' ? 'ด่วน' : 'ปกติ'}</span></td>
                    <td><span class="status status-${task.status.replace(' ', '').toLowerCase()}">${getStatusText(task.status)}</span></td>
                    <td style="font-size: 12px;">
                        <div><strong>เริ่ม:</strong> ${task.startDate ? new Date(task.startDate).toLocaleDateString('th-TH') : 'ไม่ระบุ'}</div>
                        <div><strong>สิ้นสุด:</strong> ${new Date(task.dueDate).toLocaleDateString('th-TH')}</div>
                        <div style="color: ${isOverdue(task.dueDate) && task.status !== 'Done' ? '#dc3545' : '#6c757d'};">
                            ${isOverdue(task.dueDate) && task.status !== 'Done' ? '⚠️ เกินกำหนด' : getDaysUntilDue(task.dueDate)}
                        </div>
                        ${task.completedDate ? `<div style="color: #28a745;"><strong>เสร็จ:</strong> ${task.completedDate}</div>` : ''}
                    </td>
                    <td>
                        <div class="actions">
                            <select class="btn btn-small" onchange="updateTaskStatus(${task.id}, this.value)" onclick="event.stopPropagation()">
                                <option value="To Do" ${task.status === 'To Do' ? 'selected' : ''}>รอทำ</option>
                                <option value="In Progress" ${task.status === 'In Progress' ? 'selected' : ''}>กำลังทำ</option>
                                <option value="Review" ${task.status === 'Review' ? 'selected' : ''}>ตรวจสอบ</option>
                                <option value="Done" ${task.status === 'Done' ? 'selected' : ''}>เสร็จ</option>
                            </select>
                            <button class="btn btn-danger btn-small" onclick="deleteTask(${task.id}); event.stopPropagation();">ลบ</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusText(status) {
            const statusMap = {
                'To Do': 'รอทำ',
                'In Progress': 'กำลังทำ',
                'Review': 'ตรวจสอบ',
                'Done': 'เสร็จ'
            };
            return statusMap[status] || status;
        }

        function getFilteredTasks() {
            const statusFilter = document.getElementById('filterStatus').value;
            const assigneeFilter = document.getElementById('filterAssignee').value;
            const urgencyFilter = document.getElementById('filterUrgency').value;
            const searchTerm = document.getElementById('searchTasks').value.toLowerCase();
            
            return tasks.filter(task => {
                return (!statusFilter || task.status === statusFilter) &&
                       (!assigneeFilter || task.assignee === assigneeFilter) &&
                       (!urgencyFilter || task.urgency === urgencyFilter) &&
                       (!searchTerm || task.title.toLowerCase().includes(searchTerm) || 
                        task.description.toLowerCase().includes(searchTerm));
            });
        }

        function filterTasks() {
            renderTasks();
        }

        function updateTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                if (newStatus === 'Done' && !task.completedDate) {
                    task.completedDate = new Date().toLocaleDateString('th-TH');
                }
                
                saveData();
                renderTasks();
                updateStats();
                updateCollaborationStats();
                
                sendNotification(`อัปเดตสถานะงาน`, `${task.title} เปลี่ยนเป็น ${getStatusText(newStatus)}`);
            }
        }

        function deleteTask(taskId) {
            if (confirm('ต้องการลบงานนี้หรือไม่?')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveData();
                renderTasks();
                updateStats();
                updateCollaborationStats();
            }
        }

        function viewTaskDetails(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            const modal = document.getElementById('taskModal');
            const content = document.getElementById('taskModalContent');
            
            content.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>งาน:</strong> ${task.title}
                    ${task.recurring ? '<span class="recurring-badge" style="margin-left: 10px;">งานประจำ</span>' : ''}
                </div>
                <div style="margin-bottom: 15px;"><strong>ผู้มอบหมาย:</strong> ${task.assigner || 'ไม่ระบุ'}</div>
                <div style="margin-bottom: 15px;"><strong>ผู้รับผิดชอบ:</strong> ${task.assignee}</div>
                <div style="margin-bottom: 15px;"><strong>ความเร่งด่วน:</strong> ${task.urgency === 'Urgent' ? 'ด่วน' : 'ปกติ'}</div>
                <div style="margin-bottom: 15px;"><strong>สถานะ:</strong> ${getStatusText(task.status)}</div>
                <div style="margin-bottom: 15px;"><strong>วันเริ่มงาน:</strong> ${task.startDate ? new Date(task.startDate).toLocaleDateString('th-TH') : 'ไม่ระบุ'}</div>
                <div style="margin-bottom: 15px;"><strong>กำหนดส่ง:</strong> ${new Date(task.dueDate).toLocaleDateString('th-TH')}</div>
                <div style="margin-bottom: 15px;"><strong>สร้างเมื่อ:</strong> ${task.createdTime}</div>
                ${task.completedDate ? `<div style="margin-bottom: 15px;"><strong>เสร็จเมื่อ:</strong> ${task.completedDate}</div>` : ''}
                <div style="margin-bottom: 15px;"><strong>รายละเอียด:</strong><br>${task.description || 'ไม่มีรายละเอียด'}</div>
                ${task.files.length > 0 ? `
                    <div style="margin-bottom: 15px;">
                        <strong>ไฟล์แนบ:</strong><br>
                        ${task.files.map(file => `<div>📎 ${file.name}</div>`).join('')}
                    </div>
                ` : ''}
                ${task.links.length > 0 ? `
                    <div style="margin-bottom: 15px;">
                        <strong>ลิงก์:</strong><br>
                        ${task.links.map(link => `<div>🔗 <a href="${link}" target="_blank">${link}</a></div>`).join('')}
                    </div>
                ` : ''}
            `;
            
            modal.style.display = 'flex';
        }

        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'Done').length;
            const urgent = tasks.filter(t => t.urgency === 'Urgent' && t.status !== 'Done').length;
            const recurring = tasks.filter(t => t.recurring).length;
            const overdue = tasks.filter(t => isOverdue(t.dueDate) && t.status !== 'Done').length;
            
            document.getElementById('totalTasks').textContent = total;
            document.getElementById('completedTasks').textContent = completed;
            document.getElementById('urgentTasks').textContent = urgent;
            document.getElementById('recurringTasks').textContent = recurring;
            document.getElementById('overdueTasks').textContent = overdue;
        }

        function updateCollaborationStats() {
            const faridaTasks = tasks.filter(t => t.assignee === 'FARIDA' || t.assignee === 'Both').length;
            const warisaTasks = tasks.filter(t => t.assignee === 'WARISA' || t.assignee === 'Both').length;
            
            const faridaElement = document.getElementById('FARIDA-workload');
            const warisaElement = document.getElementById('WARISA-workload');
            
            if (faridaElement) faridaElement.textContent = `${faridaTasks} งานที่ได้รับมอบหมาย`;
            if (warisaElement) warisaElement.textContent = `${warisaTasks} งานที่ได้รับมอบหมาย`;
        }

        function autoBalance() {
            const unbalancedTasks = tasks.filter(t => t.status === 'To Do');
            if (unbalancedTasks.length === 0) {
                alert('ไม่มีงานที่ต้องจัดสมดุล');
                return;
            }
            
            unbalancedTasks.forEach((task, index) => {
                const faridaLoad = tasks.filter(t => (t.assignee === 'FARIDA' || t.assignee === 'Both') && t.status !== 'Done').length;
                const warisaLoad = tasks.filter(t => (t.assignee === 'WARISA' || t.assignee === 'Both') && t.status !== 'Done').length;
                
                if (faridaLoad <= warisaLoad) {
                    task.assignee = 'FARIDA';
                } else {
                    task.assignee = 'WARISA';
                }
            });
            
            saveData();
            renderTasks();
            updateCollaborationStats();
            alert('จัดสมดุลงานเรียบร้อยแล้ว!');
        }

        // File Management
        document.getElementById('taskFiles').addEventListener('change', function(e) {
            taskFiles = Array.from(e.target.files);
            displayFileList();
        });

        function displayFileList() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            taskFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <span>📎 ${file.name} (${(file.size/1024).toFixed(1)} KB)</span>
                    <button onclick="removeFile(${index})" class="btn btn-danger btn-small">ลบ</button>
                `;
                fileList.appendChild(fileItem);
            });
        }

        function removeFile(index) {
            taskFiles.splice(index, 1);
            displayFileList();
        }

        function addLink() {
            const linkInput = document.getElementById('taskLinks');
            const link = linkInput.value.trim();
            
            if (link && !taskLinks.includes(link)) {
                taskLinks.push(link);
                linkInput.value = '';
                displayLinksList();
            }
        }

        function displayLinksList() {
            const linksList = document.getElementById('linksList');
            linksList.innerHTML = '';
            
            taskLinks.forEach((link, index) => {
                const linkItem = document.createElement('div');
                linkItem.className = 'link-item';
                linkItem.innerHTML = `
                    <span>🔗 <a href="${link}" target="_blank">${link}</a></span>
                    <button onclick="removeLink(${index})" class="btn btn-danger btn-small">ลบ</button>
                `;
                linksList.appendChild(linkItem);
            });
        }

        function removeLink(index) {
            taskLinks.splice(index, 1);
            displayLinksList();
        }

        // Folder Management
        function createFolder() {
            const name = prompt('ชื่อโฟล์เดอร์:');
            if (name) {
                folders[name.toLowerCase()] = [];
                saveData();
                renderFolders();
            }
        }

        function openFolder(folderName) {
            document.getElementById('currentFolderName').textContent = folderName;
            const modal = document.getElementById('folderModal');
            const content = document.getElementById('folderContent');
            
            const files = folders[folderName] || [];
            content.innerHTML = files.length > 0 ? 
                files.map(file => `
                    <div class="file-item">
                        <span>📄 ${file.name}</span>
                        <button onclick="removeFileFromFolder('${folderName}', '${file.name}')" class="btn btn-danger btn-small">ลบ</button>
                    </div>
                `).join('') : 
                '<div style="text-align: center; color: #6c757d; padding: 40px;">โฟล์เดอร์ว่าง</div>';
            
            modal.style.display = 'flex';
        }

        function renderFolders() {
            const grid = document.getElementById('folderGrid');
            grid.innerHTML = Object.keys(folders).map(folderName => `
                <div class="folder-card" onclick="openFolder('${folderName}')">
                    <div class="folder-icon">📁</div>
                    <div>${folderName}</div>
                    <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">${folders[folderName].length} ไฟล์</div>
                </div>
            `).join('');
        }

        function removeFileFromFolder(folderName, fileName) {
            if (confirm(`ต้องการลบไฟล์ ${fileName} หรือไม่?`)) {
                folders[folderName] = folders[folderName].filter(file => file.name !== fileName);
                saveData();
                openFolder(folderName);
                renderFolders();
            }
        }

        // File upload for folders
        document.getElementById('folderUpload').addEventListener('change', function(e) {
            const folderName = document.getElementById('currentFolderName').textContent;
            const files = Array.from(e.target.files);
            
            files.forEach(file => {
                folders[folderName].push({
                    name: file.name,
                    size: file.size,
                    uploadDate: new Date().toLocaleDateString('th-TH')
                });
            });
            
            saveData();
            openFolder(folderName);
            renderFolders();
        });

        // Modal Management
        function closeModal() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // Notifications
        function toggleNotification(element) {
            element.classList.toggle('active');
            saveUserSettings();
        }

        function sendNotification(title, message) {
            console.log(`การแจ้งเตือน: ${title} - ${message}`);
            addToActivityFeed(`${title}: ${message}`);
        }

        function addToActivityFeed(activity) {
            const feed = document.getElementById('activityFeed');
            const item = document.createElement('div');
            item.style.cssText = 'padding: 10px; border-left: 3px solid #4facfe; margin-bottom: 10px; background: #f8f9fa;';
            item.innerHTML = `
                <div style="font-weight: 600;">${activity}</div>
                <div style="font-size: 12px; color: #6c757d;">เมื่อสักครู่</div>
            `;
            feed.insertBefore(item, feed.firstChild);
        }

        function testLineNotification() {
            const token = document.getElementById('lineToken').value;
            if (!token) {
                alert('กรุณากรอก LINE Token');
                return;
            }
            saveUserSettings();
            alert('ส่งการแจ้งเตือนทดสอบไปยัง LINE แล้ว (จำลอง)');
        }

        function testEmailNotification() {
            const email = document.getElementById('emailSettings').value;
            if (!email) {
                alert('กรุณากรอกอีเมล');
                return;
            }
            saveUserSettings();
            alert(`ส่งการแจ้งเตือนทดสอบไปยัง ${email} แล้ว (จำลอง)`);
        }

        function copyShareLink() {
            const link = document.getElementById('shareLink');
            link.select();
            document.execCommand('copy');
            alert('คัดลอกลิงก์เรียบร้อยแล้ว!');
        }

        // Settings Management
        function saveUserSettings() {
            userSettings.lineToken = document.getElementById('lineToken').value;
            userSettings.emailSettings = document.getElementById('emailSettings').value;
            
            userSettings.notifications = [];
            document.querySelectorAll('.toggle').forEach((toggle, index) => {
                userSettings.notifications[index] = toggle.classList.contains('active');
            });
            
            saveData();
        }

        function restoreUserSettings() {
            if (userSettings.lineToken) {
                document.getElementById('lineToken').value = userSettings.lineToken;
            }
            if (userSettings.emailSettings) {
                document.getElementById('emailSettings').value = userSettings.emailSettings;
            }
            
            if (userSettings.notifications) {
                document.querySelectorAll('.toggle').forEach((toggle, index) => {
                    if (userSettings.notifications[index] !== undefined) {
                        if (userSettings.notifications[index]) {
                            toggle.classList.add('active');
                        } else {
                            toggle.classList.remove('active');
                        }
                    }
                });
            }
        }

        // Data Import/Export
        function exportData() {
            const exportData = {
                tasks: tasks,
                folders: folders,
                taskCounter: taskIdCounter,
                userSettings: userSettings,
                exportDate: new Date().toISOString(),
                version: '1.0'
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `work-coordination-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('ส่งออกข้อมูลเรียบร้อย!');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        if (confirm('การนำเข้าจะเขียนทับข้อมูลปัจจุบัน ต้องการดำเนินการต่อหรือไม่?')) {
                            tasks = importedData.tasks || [];
                            folders = importedData.folders || {documents: [], images: [], shared: []};
                            taskIdCounter = importedData.taskCounter || 1;
                            userSettings = importedData.userSettings || {};
                            
                            saveData();
                            loadUserData();
                            restoreUserSettings();
                            
                            alert(`นำเข้าข้อมูลเรียบร้อย!\n- งาน: ${tasks.length} รายการ\n- โฟล์เดอร์: ${Object.keys(folders).length} โฟล์เดอร์`);
                        }
                    } catch (error) {
                        alert('ไฟล์ไม่ถูกต้องหรือเสียหาย');
                        console.error('Import error:', error);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('ต้องการลบข้อมูลทั้งหมดหรือไม่?\n⚠️ การกระทำนี้ไม่สามารถยกเลิกได้!')) {
                if (confirm('ยืนยันอีกครั้ง: ลบข้อมูลทั้งหมดจริงหรือไม่?')) {
                    Object.values(STORAGE_KEYS).forEach(key => localStorage.removeItem(key));
                    tasks = [];
                    folders = {documents: [], images: [], shared: []};
                    taskIdCounter = 1;
                    userSettings = {};
                    
                    loadUserData();
                    alert('ลบข้อมูลทั้งหมดเรียบร้อย');
                }
            }
        }

        function showStorageInfo() {
            let totalSize = 0;
            const breakdown = {};
            
            Object.entries(STORAGE_KEYS).forEach(([name, key]) => {
                const data = localStorage.getItem(key);
                const size = data ? data.length : 0;
                breakdown[name] = size;
                totalSize += size;
            });
            
            const storageInfo = document.getElementById('storageInfo');
            const storageDetails = document.getElementById('storageDetails');
            
            storageDetails.innerHTML = `
                <p><strong>ขนาดรวม:</strong> ${(totalSize / 1024).toFixed(2)} KB</p>
                <p><strong>งาน:</strong> ${(breakdown.TASKS / 1024).toFixed(2)} KB</p>
                <p><strong>โฟล์เดอร์:</strong> ${(breakdown.FOLDERS / 1024).toFixed(2)} KB</p>
                <p><strong>การตั้งค่า:</strong> ${(breakdown.USER_SETTINGS / 1024).toFixed(2)} KB</p>
                <p><strong>จำนวนงาน:</strong> ${tasks.length} รายการ</p>
                <p><strong>จำนวนโฟล์เดอร์:</strong> ${Object.keys(folders).length} โฟล์เดอร์</p>
            `;
            
            storageInfo.style.display = storageInfo.style.display === 'none' ? 'block' : 'none';
        }

        // PDF Report Generation
        function generateReport() {
            const reportData = {
                title: 'รายงานการทำงาน Work in Coordination',
                date: new Date().toLocaleDateString('th-TH'),
                user: currentUser,
                stats: {
                    total: tasks.length,
                    completed: tasks.filter(t => t.status === 'Done').length,
                    pending: tasks.filter(t => t.status !== 'Done').length,
                    urgent: tasks.filter(t => t.urgency === 'Urgent').length,
                    overdue: tasks.filter(t => isOverdue(t.dueDate) && t.status !== 'Done').length
                },
                tasks: tasks
            };
            
            const reportHTML = generateReportHTML(reportData);
            const newWindow = window.open('', '_blank');
            newWindow.document.write(reportHTML);
            newWindow.document.close();
            newWindow.print();
        }

        function generateReportHTML(data) {
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${data.title}</title>
                    <style>
                        body { font-family: 'Sarabun', sans-serif; margin: 40px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 30px; }
                        .stat-box { border: 1px solid #ddd; padding: 15px; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background: #f5f5f5; }
                        .urgent { color: red; font-weight: bold; }
                        .completed { color: green; }
                        .overdue { color: red; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${data.title}</h1>
                        <p>วันที่: ${data.date} | ผู้ใช้: ${data.user}</p>
                    </div>
                    
                    <div class="stats">
                        <div class="stat-box">
                            <h3>${data.stats.total}</h3>
                            <p>งานทั้งหมด</p>
                        </div>
                        <div class="stat-box">
                            <h3>${data.stats.completed}</h3>
                            <p>เสร็จแล้ว</p>
                        </div>
                        <div class="stat-box">
                            <h3>${data.stats.pending}</h3>
                            <p>รอดำเนินการ</p>
                        </div>
                        <div class="stat-box">
                            <h3>${data.stats.urgent}</h3>
                            <p>งานด่วน</p>
                        </div>
                        <div class="stat-box">
                            <h3>${data.stats.overdue}</h3>
                            <p>เกินกำหนด</p>
                        </div>
                    </div>
                    
                    <h2>รายละเอียดงาน</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ชื่องาน</th>
                                <th>ผู้มอบหมาย</th>
                                <th>ผู้รับผิดชอบ</th>
                                <th>สถานะ</th>
                                <th>ความเร่งด่วน</th>
                                <th>กำหนดส่ง</th>
                                <th>สร้างเมื่อ</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.tasks.map((task, index) => `
                                <tr class="${task.status === 'Done' ? 'completed' : ''} ${isOverdue(task.dueDate) && task.status !== 'Done' ? 'overdue' : ''}">
                                    <td>${index + 1}</td>
                                    <td>${task.title}</td>
                                    <td>${task.assigner || 'ไม่ระบุ'}</td>
                                    <td>${task.assignee}</td>
                                    <td>${getStatusText(task.status)}</td>
                                    <td class="${task.urgency === 'Urgent' ? 'urgent' : ''}">${task.urgency === 'Urgent' ? 'ด่วน' : 'ปกติ'}</td>
                                    <td>${new Date(task.dueDate).toLocaleDateString('th-TH')}</td>
                                    <td>${task.createdDate}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
        }

        // Utility functions
        function isOverdue(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            return due < today;
        }

        function getDaysUntilDue(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'วันนี้';
            if (diffDays === 1) return 'พรุ่งนี้';
            if (diffDays > 0) return `อีก ${diffDays} วัน`;
            return `เกิน ${Math.abs(diffDays)} วัน`;
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('taskStartDate').min = today;
            document.getElementById('taskDueDate').min = today;
            
            // Drag and drop file upload
            const fileUploadLabel = document.querySelector('.file-upload-label');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileUploadLabel.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                fileUploadLabel.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                fileUploadLabel.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                fileUploadLabel.style.borderColor = '#4facfe';
                fileUploadLabel.style.backgroundColor = '#f8f9ff';
            }

            function unhighlight(e) {
                fileUploadLabel.style.borderColor = '#e9ecef';
                fileUploadLabel.style.backgroundColor = 'white';
            }

            fileUploadLabel.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                taskFiles = Array.from(files);
                displayFileList();
            }
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
            
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                document.getElementById('taskTitle').focus();
            }
            
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                generateReport();
            }
        });

        // Periodic checks for overdue tasks
        setInterval(function() {
            tasks.forEach(task => {
                if (isOverdue(task.dueDate) && task.status !== 'Done' && !task.notified) {
                    sendNotification('งานเกินกำหนด', `งาน "${task.title}" เกินกำหนดแล้ว`);
                    task.notified = true;
                }
                
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dueDate = new Date(task.dueDate);
                
                if (dueDate.toDateString() === tomorrow.toDateString() && 
                    task.status !== 'Done' && !task.reminderSent) {
                    sendNotification('เตือนงานใกล้ครบกำหนด', `งาน "${task.title}" ครบกำหนดพรุ่งนี้`);
                    task.reminderSent = true;
                }
            });
        }, 60000);

        // Simulate collaboration activity
        function simulateCollaboration() {
            const actions = [
                'FARIDA เข้าสู่ระบบ',
                'WARISA อัปเดตสถานะงาน',
                'Admin เพิ่มงานใหม่',
                'FARIDA แนบไฟล์',
                'WARISA เสร็จสิ้นงาน'
            ];
            
            setInterval(() => {
                if (Math.random() > 0.8) {
                    const randomAction = actions[Math.floor(Math.random() * actions.length)];
                    addToActivityFeed(randomAction);
                }
            }, 30000);
        }

        // Initialize
        window.addEventListener('load', function() {
            renderFolders();
            simulateCollaboration();
        });
    </script>
</body>
</html>